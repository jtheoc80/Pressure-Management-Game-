// lib/psv/types.ts
/**
 * PSV Sizing Quest (Puffer) — Core Types
 * Training game only. Do not use for engineering sizing.
 */

export type ServiceType = "gas" | "steam" | "liquid" | "two_phase";
export type DischargeTo = "atm" | "flare" | "closed";
export type ValveStyle = "conventional" | "bellows" | "pilot";

export type Difficulty = 1 | 2 | 3 | 4 | 5;

export type OrificeLetter =
  | "D"
  | "E"
  | "F"
  | "G"
  | "H"
  | "J"
  | "K"
  | "L"
  | "M"
  | "N"
  | "P"
  | "Q"
  | "R"
  | "T";

export type RelievingCase =
  | "blocked_outlet"
  | "fire_case"
  | "control_valve_failure"
  | "thermal_expansion"
  | "utility_failure"
  | "check_valve_failure"
  | "other";

export type VisualKey =
  | "steam_header_thumbnail"
  | "flare_line_thumbnail"
  | "pump_thermal_thumbnail";

export type VisualWidgetKey =
  | "ReliefPathDiagram"
  | "BackpressureGauge"
  | "ValveCutaway"
  | "OrificeWheel";

/**
 * Datasheet filled out by the learner.
 * Keep this structured and consistent — it’s the “game controller.”
 */
export type Datasheet = {
  scenarioId: string;

  // Header / context
  unitArea?: string; // e.g., "Crude Unit – Overhead"
  equipment?: string; // e.g., "Reflux Drum"
  preparedBy?: string;
  preparedAtISO?: string;

  // Service + basis
  serviceType: ServiceType;
  relievingCase: RelievingCase;
  dischargeTo: DischargeTo;

  // Pressures & temperature
  setPressurePsig?: number;
  relievingTempF?: number;

  // Required capacity basis (training only; answer-key grading)
  requiredMassFlowLbHr?: number; // gas/steam
  requiredVolFlowGpm?: number; // liquid

  // Gas/steam properties
  mw?: number; // molecular weight
  k?: number; // Cp/Cv
  z?: number; // compressibility

  // Liquid properties
  densitySg?: number; // specific gravity
  viscosityCp?: number;
  vaporPressurePsia?: number;

  // Backpressure (logic training, not equations)
  superimposedBackpressurePsig?: number;
  builtUpBackpressurePsig?: number;

  notes?: string;
};

export type Scenario = {
  id: string;
  title: string;
  description: string;

  serviceType: ServiceType;
  difficulty: Difficulty;

  // Operational constraints written as short, meaningful phrases
  constraints: string[];

  /**
   * Field keys required to earn full datasheet credit for this scenario.
   * Use Datasheet keys as strings (e.g., "mw", "k", "z", "requiredMassFlowLbHr").
   */
  datasheetRequirements: Array<keyof Datasheet>;

  visuals: {
    thumbnail: VisualKey;
    widgets: VisualWidgetKey[];
  };

  // Optional: attachments for realism (P&ID snippet, process note, etc.)
  attachments?: Array<{
    id: string;
    title: string;
    type: "svg" | "markdown";
    contentRef: string; // e.g., "pid_snippet_steam
